Версия 1.0.18.5
---------------
Реализована регулировка уровня контрольного напряжения в соответствии с приказом от управляющей системы 
(протокол версии 41). Исправлены ошибки в поле dgn статуса при двукратном переводе, а также ошибки в 
логике работы двукратного перевода.


Версия 1.0.18.6
---------------
Реализована смена активности по приказу от управляющей системы (протокол версии 41).
Приказ выполняется в следующих случаях:
1. Оба ТЭЗа находятся в рабочем состоянии;
2. Оба ТЭЗа находятся в безопасном состоянии и у того, кому передаётся активность, 
работает хотя бы одна линия обмена с управляющей системой.


Версия 1.0.18.7
---------------
Исправлена ошибка, причиной которой является неправильная настройка сценария синхронизации контрольной суммы
ПЗУ в файле CheckFlashChecksum.c (отсутствие времени формирования синхронизированного параметра t2). Внешние 
проявления ошибки - при прошивке МК1 и МК2 файлами с разной контрольной суммой ПЗУ прибор не уходил в защитное 
состояние по контролю синхронизируемого параметра на совпадение.


Версия 1.0.18.8
---------------
Убрана возможность выполнения приказа по смене активности от УС, если оба прибора находятся в безопасном состоянии.
Устранена ошибка, проявляющаяся в следующем: когда при установленном приказе смены активности либо при включении 
питания 24В на оба прибора, либо при включении в кросс-плату одного ТЭЗа при уже установленном втором и поданном 
питании 24В происходила неудачная попытка смены активности до момента, когда на приборе, который должен получить 
активность, не истекал таймер инициализации (для активного прибора - 3с, для пассивного - 5с).
Для устранения ошибки в межприборный обмен введен дополнительный параметр - состояние инициализации прибора.


Версия 1.0.18.9
---------------
1.Исправлена следующая ошибка:
Основной прибор - активный, рабочий. Выключаем на нём 220В, он отдаёт активность рабочему резервному. Выключаем на 
резервном 24В, при этом активность не возвращается на основной прибор, а возвращается только если включить у него 220В.
Изменения коснулись кода функции passiveState менеджера активности.
Замечание: модуль менеджера активности надо прорабатывать более глубоко с участием отдела ИУС, так как существует много 
неоднозначностей с точки зрения поведения контроллера в тех или иных ситуациях. 
2. Изменен модуль контрольного генератора и модуль управления стрелочным переводом. Это позволило удалить таймаут на 
определение положения стрелки в функции NineWireShuntShift_run модуля управления переводом стрелки.
3. <to do> При испытаниях на КЗ контрольного генератора наблюдался переход в ЗС по превышению времени формирования 
синхронизируемого параметра T2 (напряжение с выхода бесконтактного датчика). Вероятная причина ошибка настройки параметра в 
сценарии синхронизации.Возможное решение - изменение middleRangeValue в сценарии на число, соответствующее примерно половине 
от максимально возможной величины сигнала </to do>. Устранение замечания предполагается внести в следующую версию ПО.  


Версия 1.0.19
-------------
Заводская версия, повторяющая версию 1.0.18.9


Версия 1.0.20
-------------
1. Изменено номинальное значение для определения неисправности корректора коэффициента мощности (увеличено на 5%).
2. В сценарии синхронизации парметров межпроцессорного обмена (напряжение генератора контрольных цепей, напряжения с 
   беконтактных датчиков положения стрелки) изменён параметр middleRangeValue (причина - некорректная работа процедуры 
   контроля этих параметров, когда измеряемые величины находятся около нуля).


Версия 1.0.20.1
---------------
1.ВРЕМЕННО!!! отключен компонент IntegrCtrl (контроль целостности обмоток). Причина - проверка времени формирования 
поля dgn после выдачи приказа на перевод.
2.Добавлено поле PH (состояние и фаза перевода стрелки) в телеграмму статуса и его формирование.
3.В функцию checkGeneratorData модуля генератора контрольного напряжения добавлена проверка актуальности полученных данных 
(то есть учтено время реакции на переходной процесс), когда в приказе меняется уровень напряжения, формируемого генератором
Добавлена проверка выхода генератора  за пороговые значения по обратной связи и добавлена выдача соотвествующего кода аларма
4. Включен компонент ControlMK и удалена используемая внутри него ненужная синхронизация полученных данных между процессорами.


Версия 1.0.20.2
---------------
1. Компонент IntegrCtrl включен и для ускорения процесса отключения контроля целостности обмоток 
(что актуально при выполнении приказа на перевод стрелки) добавлено условие
if ( stepCnt != eCalcUfbPhase )
        stepCnt = eDecLevel;
в функции IntegrCtrl_turnOff;
2. Изменения в функции checkGeneratorData (устранены ошибки).
3. Добавлена запись в EEPROM адреса ПЗУ, с которого произошёл вход в немаскируемое аппаратное прерывание МК
(изменены файлы unused_interrupt.c и ProtectionState_codes.h).
4. Изменена логика обработки приказа. Приказ выполняется только когда текущий не равен предыдущему и не равен пустому.
Например: стрелка в положениии "+", контроль положения "-" отсутствует. При поступлении приказа на перевод в "-" прибор его выполнит до 
того момента, пока не истечёт таймер времени максимального перевода. Повторный приказ на перевод в "+" может быть выполнен ТОЛЬКО после 
получения приказа с пустым статусом.  П.4 проверялся ПОКА только на однократном переводе. 


Версия 1.0.20.3
---------------
1. Добавлено сохранение регистра RCON в качестве параметра при переходе в 3С при возникновении некорректного сброса МК.
2. Удалён лишний код в функции PosDetGenerator_run (лишнее состояние автомата и соответствующие переменные)
3. Исправлены следующие ошибки:
- при отстуствии целевого контроля положения стрелки максимально время перевода было НЕ РАВНО фактическому времени перевода стрелки;
- в режиме двукратного перевода при отсутствии целевого контроля осуществлялась только ПЕРВАЯ фаза перевода 
вместо положенных 4-х (при неизменяемом приказе на перевод) - ошибка появилась после изменения логики обработки приказа в версии 1.0.20.2;
- при отсутствии целевого контроля и окончании перевода (по истечению времени максимального перевода) поле ERR2 
  статуса ошибочно устанавливалось в положение "Потеря контроля без команды на перевод";
- при смене положения стрелки на противоположное БЕЗ ПЕРЕВОДА стрелки не выполянялся приказ на перевод в то положение, 
  из которого производилась "ручная" смена положения;


Версия 1.0.21
-------------
Заводская версия, повторяющая версию 1.0.20.3


Версия 1.0.21.1
---------------
1. Добавлена инициализация массива буфера суммы отсчётов напряжений обратной связи фаз (для контроля корректора коэфф. мощности)
2. Удалена возможность контроля корректора при коротком замыкании рабочих цепей (внешнее проявление - переход в ЗС при КЗ 
   рабочих цепей во время перевода стрелки с кодом ошибки контроля ККМ );
3. Расширена очередь отсчётов результатов сэмплирования АЦП (на 2 элемента), прерывания в функциях Adc_get и Adc_isReady
   запрещены на время работы с очередью. Внешнее проявление ошибки - переход в ЗС по переполнению очереди;
4. Исправлены ошибки в логике обработки приказа:
   - при подаче питания и пустом приказе отсутствовал контроль целостности обмоток;
   - при отсутствии целевого контроля после окончания выполнения перевода не включался контроль целостности обмоток;
   - не включался контроль целостности обмоток при остановке перевода командой "Стоп";
   - не включался контроль целостности обмоток при смене во время перевода команды установки в противоположное положение на пустой приказ;
   - не изменялось значение поля PH статуса при смене приказа во время активного перевода стрелки на пустой;
   - при активном переводе стрелки, при появлении КЗ рабочих цепей или их обрыва и последующего восстановления рабочего состояния,
     приказ на перевод после смены на пустой и возврата к предыдущему не выполнялся;
   - при КЗ или обрыве рабочих цепей в поле ERR2 статуса ложно появлялась "Потеря контроля без команды на перевод".
5. Добавлено интегрирование результатов контроля ККМ со следующей логикой: тестирование ККМ считается НЕУСПЕШНЫМ, если
    4 подряд идущих теста ККМ неуспешны. 


Версия 1.0.22
-------------
1. Переписана функция isPosDetChangedNoShift. Причина - ошибки в достоверном определении потери контроля без комнады на перевод.
2. Исправлена ошибка, когда при появлении КЗ рабочих цепей во время перевода стрелки и последующем его снятии в первом цикле тестирования 
   целостности рабочих цепей ложно обнаруживался обрыв одной фазы.


Версия 1.0.23
-------------
1. Добавлено обнуление переменных модуля контроля целостности рабочих цепей при включении модуля в функции IntegrCtrl_run:
sumBreak, sumShortCircuit, typeTesting;
2.Изменено значение константы (увеличено до 300 мс) TIME_STABLE_STATE в функции isPosDetChangedNoShift. Причина - редкие "промигивания"
состояния "Потеря контроля без команды на перевод стрелки" в поле ERR2 cтатуса (обнаружено при работе на реальную стрелку) при:
- останове перевода командой "Стоп";
- смене направления вращения двигателя во время перевода стрелки


Версия 1.0.24
-------------
Счетчик номера цикла в приказе имеет разрядность 8 бит, поэтому после значения 0xFF следует
значение 0. При проверке согласованности внутреннего счётчика totalStr->numberCycleOK со счётчиком
в приказе результат вычислений имеет разрядность 16 бит и за значением 0xFF следует значение 0x0100,
в результате чего приказ игнорируется. Для устранения этой проблемы сделано приведение к типу uint8_t.


Версия 1.0.24.1
---------------
Уменьшено значение константы определения короткого замыкания рабочих цепей при тестировании 
целостности обмоток.


Версия 1.0.24.2
---------------
Добавлена обработка положения стрелки "Ложное положение (наличие + и -)"


Версия 1.0.24.3
---------------
Тестовая версия.
В статусе в поле токов фаз выводятся значения, по которым в модуле контроля целостности обмоток
принимается решение о коротком замыкании.


Версия 1.0.24.4
---------------
1. Поднята до 29 константа порогового значения, по которой определяется короткое замыкание при тестировании 
целостности обмоток (to do - возможно, придётся пересмотреть скорость нарастания тестового импульса в сторону 
увеличения);
2. В поле ERR2 добавлено состояние "Перегрузка рабочих цепей";
3. Устранена ошибка в логике обработки приказа, проявляющаяся в следующем: при коротком замыкании цепей 
контрольного генератора НЕ ПРИ ПЕРЕВОДЕ СТРЕЛКИ последующий приказ на перевод стрелки НЕ ВЫПОЛНЯЛСЯ. Если этот 
тип КЗ возникал ПРИ ПЕРЕВОДЕ стрелки, перевод заканчивался по таймеру времени максимального перевода из приказа, но
последующий приказ на перевод стрелки не выполнялся;
4. Исправлена ошибка, проявляющаяся в отсутствии обработки приказа при появлении перегрузки по току после изменения 
этого приказа. Для этого добавлена обработка неиспользуемого параметра межпроцессорного обмена eICId_ShuntShiftMotor_failure.


Версия 1.0.24.5
---------------
1. Вернули назад порог перегрузки по току в 4А (для тестирования на эквиваленте стрелки было 3.2А)
2. Добавлены к имеющимся четырём ещё 3 буфера трассировки.


Версия 1.0.24.6
---------------
Исправлены следующие ошибки:
1. При двукратном переводе при появлении перегрузки по току не останавливается перевод стрелки.
Выражалось в разгоне двигателя по всем 4 фазам перевода (след. пункты для режима однократного перевода)
2. После изменений в части алгоритма обработки перегрузки по току отсутствует определение потери контроля без команды на перевод.
(to do - проверить корректность изменения данных в поле ERR2 последовательно меняя перегрузку и снимая контроль стрелки,
проверка возможна только в ЛТИ, на эквиваленет стрелки воспроизвести невозможно );
3. При появлении перегрузки dgn = 3 становится раньше, чем появляется изменение в поле ERR2 в состояние "Перегрузка по току рабочих цепей"
при выполнении приказа;
4. В следующем приказе, выполняемом после того, как предыдущий завершился по перегрузке по току, значение поля ERR2 сбрасывается через 4 
цикла после установки dgn в "Перевод активен".
5. Не выполняется приказ на перевод в противоположное положение при подаче питания. Выполняется только через смену приказа 
Такое происходит, когда период приказов не более 200 мс. На 500 мс (а при запуске АРМ ПСИ именно такой период и стоит); 
ошибка не проявляется. Ошибка появилась при переходе от версии 1.0.21.1 к 1.0.22 (до 1.0.22 её не было);
6. Поле dgn не устанавливается в положение "Перевод окончен неудачей" при ЛЮБЫХ нештатных ситуациях (КЗ, обрыв, перегрузка по току)
при двукратном переводе стрелки;
7. При переключении на резерв иногда обнаруживается обрыв рабочей цепи в первом цикле тестирования в приборе, которому передана 
активность. Вероятно, это связано с тем, что переключение реле РПВ совпадает в эти моменты с максимумом тестового импульса, 
на приборе, который до этого был пассивным и по которому принимается решение об обрыве - контрольные импульсы в модуле контроля
целостности выдаются теперь ТОЛЬКО на активном приборе;
8. Удалено отключение прерываний при работе с очередью параметров АЦП.


Версия 1.0.25
-------------
Исправлено следующее:
Уход в ЗС прибора по превышению времени ожидания параметров синхронизации от обоих каналов T1 (параметр eICId_BinInPin).
Проявился при переходе на резерв на приборе,который получил активность. Синхронизация параметра eICId_BinInPin изменена с
синхронизации по изменению значения на периодическую с периодом 10 мс. Также изменён сценарий настройки синхронизации для этого 
параметра.


Версия 1.0.25.1
---------------
1. Добавлена трассировка данных получаемых в BinInPin (в массив с индексом 0);
2. Добавлена трассировка параметра eICId_BinInPin внутри InterChannel;
3. Исправлена ошибка, выраженная в том, что смена активности по приказу от АРМ 
во время перевода стрелки осуществлялась до того, как dgn получал любое отличное от 1(т.е. перевод активен) значение. 

Версия 1.0.25.2
---------------
Добавлено ещё одно условие для смены активности по внешнему приказу от УС.
Теперь смена активности по внешнему приказу возможна тогда, когда dgn не равен 1 (нет то есть отсутствует перевод стрелки)
и когда приказ пустой, то есть поле SW равно 0)


Версия 1.0.26
-------------
Заводская версия, повторяющая 1.0.25.2


Версия 1.0.26.1   
---------------
Уменьшены таймауты определения готовности генератора и накопления факта потери контроля стрелки без команды на перевод


Версия 1.0.26.2
---------------
1.При останове перевода стрелки добавлено условие установки dgn = 0 наличие нормы 220В и 24В;
2. Добавлен таймаут для обработки смены активности по внешнему приказу для того, чтобы успеть отослать в управляющую систему. 


Версия 1.0.26.3
---------------
Тестовая, предназначенная для поиска причины ложного КЗ рабочих цепей после получения активности на несколько секунд


Версия 1.0.26.4
---------------
Тестовая, увеличено до 20 мс время изменения приращения тестового сигнала контроля рабочих цепей. 
Исправления в части некорректного значения поля ERR2 статуса при КЗ рабочих цепей.
В токах фаз в телеграмме  статуса не токи, а условные уровни формируемого напряжения тестового сигнала
контроля рабочих цепей.  


Версия 1.0.26.5
---------------
Изменения в модуле определения положения стрелки (определяем положение только на активном приборе с работающим генератором)
Вернул нормальное отображение в статусах токов фаз


Версия 1.0.26.6
---------------
Изменения в функциях определения достоверности данных контрольного генератора и определения потери контроля без команды на перевод


Версия 1.0.27
-------------
Заводская версия, повторяющая 1.0.26.6


Версия 1.0.27.1
---------------
Исправлена ошибка неверного значения dgn, взятого от другого прибора при передаче активности 


Версия 1.0.27.2
---------------
1.Исправление ошибки, связанной с тем что во время выполнения активной команды на перевод и смене активности
прибор, получивший активность не стал выпаолнять приказ.
2. В модуле контроля целостности добавлена трассировка токов и напряжений (мгновенных значений) фаз
(информация понадобится для анализа отказа контроля корректора коэффициента мощности) в массивы с 0 по 5.
В 6-й массив трассировки заведена трассировка внутри InterChannel параметра eIcIdBinInPin.


Версия 1.0.27.3
---------------
Исправлена ошибка неверного условия для работы трассировки токов и напряжений в модуле контроля целостности.


Версия 1.0.27.4
---------------
1. Исправлена ошибка, связанная с тем что при выключении активного прибора, на котором;
выполняется команда на перевод стрелки - не подхватывалось выполнение команды на перевод вторым прибором. Для этого
добавлен ещё один интерфейс ShuntShift_isWork и изменена функция определения возможности выполнять приказ от УС;
2. Исправлена ошибка - значение dgn при смене активности и возобновлении её вновь бралось старое (на момент смены активности).
Для этого на резервном приборе dgn всегда равно 0;
3. Не всегда смена активности на второй прибор осуществлялась сразу (бывает после нескольких неудачных попыток).
Ошиюка стала проявляться после коррекций по синхронизации eIcIdBinInPin. Увеличены таймауты для РПВ 
T_O_RELAY_OPERATE и T_O_RELAY_RELEASE.


Версия 1.0.28
-------------
Заводская версия, повторяющая 1.0.27.4


Версия 1.0.28.1
---------------
1. Обработчики прерываний вынесены в отдельный модуль InterruptsHandlers.c, который вошёл в компонент Main;
2. Увеличено время обработки перегрузки по току;
3. Устранена ошибка когда поле dgn устанавливается перед полем err2 статуса.


Версия 1.0.29
-------------
Заводская версия, повторяющая 1.0.28.1


Версия 1.0.30
-------------
Заводская версия
1.Добавлена проверка того, что прибор находится в РС для выполнения смены активности
при переводе стрелки (если отсутствуют 220В или(и)24В) и второй прибор рабочий, активность будет изменена
независимо от поля SW приказа.
2. Исправлена следующая ошибка: при пропадании 24В или(и) 220В во время перевода стрелки перевод останавливался,
но не устанавливалось в "Перевод неудачен" значение dgn.


Версия 1.0.31
-------------
Заводская версия
Изменения:
dgn не устанавливается в "Перевод неудачен" при переходе в БС при переводе стрелки
при пропадании питания 24В или 220В, а устанавливается только если нет связи со вторым прибором или второй прибор в БС 


Версия 1.0.32
-------------
Добавлена следующая проверка выполнения критерия безопасности:
при выдаче контрольного импульса тестирования на какую-либо из фаз (то есть при отсутствии приказа от управляющей системы) проверяется то, 
что на любой из остальных двух фазах отсутствует напряжение(как среднеквадаратическое значение, так и постоянная составляющая).